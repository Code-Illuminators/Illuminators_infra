pipeline {
    agent any
    stages {
        stage('Generate Consul Token') {
            steps {
                sh '''
                    export CONSUL_BOOTSTRAP_TOKEN=$(python3 -c "import uuid; print(uuid.uuid4())")
                    export GOSSIP_TOKEN=$(consul keygen)
                    envsubst < server.hcl.template > server.hcl
                    cat server.hcl
                '''
            }
        }
    }
}